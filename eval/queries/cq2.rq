PREFIX mcbo: <http://example.org/mcbo#>

SELECT ?choLine
       (GROUP_CONCAT(DISTINCT STR(?gene); separator=", ") AS ?genes)
       (MAX(?prodVal) AS ?maxProductivity)
       (SAMPLE(?category) AS ?categoryAtMax)
WHERE {
  ?choLine a mcbo:CHOCellLine .
  ?choLine mcbo:overexpressesGene ?gene .

  ?proc mcbo:usesCellLine ?choLine ;
        mcbo:hasProductivityMeasurement ?pm .
  ?pm mcbo:hasProductivityValue ?prodVal .
  OPTIONAL { ?pm mcbo:hasProductivityCategory ?category . }
}
GROUP BY ?choLine
ORDER BY DESC(MAX(?prodVal)) ?choLine
