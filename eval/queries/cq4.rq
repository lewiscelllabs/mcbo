# CQ4: How does the expression of gene X vary between clone A and clone B?
#
# This query compares gene expression levels between two clones (subclones) of a cell line.
# Parameters: gene (X), clone A, clone B
#
# Note: Requires Clone instances in the data. If no clones exist, returns empty.

PREFIX mcbo: <http://example.org/mcbo#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX uo: <http://purl.obolibrary.org/obo/>

SELECT ?gene ?geneLabel ?cloneA ?cloneALabel ?cloneB ?cloneBLabel 
       ?exprA ?exprB ?foldChange
WHERE {
  # First, find all clone pairs (fail-fast if no clones exist)
  ?cloneA a mcbo:Clone ;
          rdfs:label ?cloneALabel .
  ?cloneB a mcbo:Clone ;
          rdfs:label ?cloneBLabel .
  # Use < instead of != to avoid duplicate pairs (A,B) and (B,A)
  FILTER(STR(?cloneA) < STR(?cloneB))
  
  # Find parent cell lines
  ?parentLineA mcbo:hasClone ?cloneA .
  ?parentLineB mcbo:hasClone ?cloneB .
  
  # Clone A expression path
  ?processA mcbo:usesCellLine ?parentLineA ;
            mcbo:hasProcessOutput ?sampleA .
  ?sampleA mcbo:hasGeneExpression ?exprMeasA .
  ?exprMeasA uo:IAO_0000136 ?gene ;
             mcbo:hasExpressionValue ?exprA .
  
  # Clone B expression path (same gene)
  ?processB mcbo:usesCellLine ?parentLineB ;
            mcbo:hasProcessOutput ?sampleB .
  ?sampleB mcbo:hasGeneExpression ?exprMeasB .
  ?exprMeasB uo:IAO_0000136 ?gene ;
             mcbo:hasExpressionValue ?exprB .
  
  OPTIONAL { ?gene rdfs:label ?geneLabel }
  OPTIONAL { ?exprMeasA mcbo:hasFoldChange ?foldChange }
}
ORDER BY ?gene ?cloneA ?cloneB

